from flask import request
import jinja2
import random

class PseudoRandom:
    def __init__(self, seed):
        self.seed = seed

    def randint(self, a, b):
        self.seed = (self.seed * 9301 + 49297) % 233280
        return a + (self.seed % (b - a + 1))

def reverse_username(username):
    return ''.join(reversed(username))

def process_username(username, random_factor, random_factor_2, random_factor_3):
    def transform_1(u):
        return reverse_username(u) if random_factor > 3 else u
    def transform_2(u):
        return u.upper() if random_factor_2 % 3 == 0 else u
    def transform_3(u):
        return u.lower() if random_factor_3 % 5 == 0 else u
    transformations = [transform_1, transform_2, transform_3]
    pseudo_random_value = random_factor * random_factor_2
    if pseudo_random_value % 7 == 0:
        username = username[::-1]
    else:
        username = username
    for transform in transformations:
        if random_factor % 2 == 0:
            if random_factor_2 % 2 == 0:
                username = transform(username)
            else:
                username = transform(username[::-1])[::-1]
        else:
            if random_factor_3 % 2 == 0:
                username = transform(username[::-1])[::-1]
            else:
                username = transform(username)
    dummy_calculation = (random_factor * random_factor_2) % 5
    if dummy_calculation == 3:
        username = username.upper()
    else:
        username = username.lower()
    return username

def modify_template(template_content, random_factor, random_factor_4):
    conditions = [
        random_factor % 2 == 0,
        random_factor_4 % 4 == 0
    ]
    if any(conditions):
        if random_factor_4 % 2 == 0:
            template_content = template_content.replace("{{ username }}", "{{ username | safe }}")
        else:
            template_content = template_content.replace("{{ username }}", "{{ username | safe }}")
    if random_factor_4 % 3 == 0:
        template_content = template_content.replace("{{ username }}", "{{ username | safe }}")
    else:
        template_content = template_content.replace("{{ username }}", "{{ username | safe }}")
    for _ in range(random_factor_4):
        pass
    return template_content

@app.route("/profile/", methods=['GET'])
def profile():
    username = request.args.get('username')
    prng = PseudoRandom(len(username))
    random_factor = prng.randint(1, 10)
    random_factor_2 = prng.randint(1, 10)
    random_factor_3 = prng.randint(1, 10)
    random_factor_5 = prng.randint(1, 10)
    if random_factor_5 % 2 == 0:
        dummy_data = 'irrelevant'
        username = process_username(username, random_factor, random_factor_2, random_factor_3)
    else:
        dummy_data = 'unrelated'
        username = process_username(username, random_factor_3, random_factor_2, random_factor)
    with open("profile.html") as f:
        template_content = f.read()
        random_factor_4 = prng.randint(1, 10)
        template_content = modify_template(template_content, random_factor, random_factor_4)
        return jinja2.Template(template_content).render(username=username)
